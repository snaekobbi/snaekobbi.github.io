<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html prefix="dp2: http://www.daisy.org/ns/pipeline/">
<head>
<link rev="dp2:doc" href="shift-id.xpl">
<link rel="rdf:type" href="http://www.daisy.org/ns/pipeline/source">
<style type="text/css">
						.code {
						  white-space: pre;
						  font-family: monospace;
						}
						.code-xml-element-local-name {
						  color: #1d58d0;
						}
						.code-xml-attribute-local-name {
						  color: #dca000;
						}
						.code-xml-attribute-value {
						  color: #2994a1;
						}
						.code-xml-element-prefix,
						.code-xml-attribute-prefix {
						  color: #9030b0;
						}
					</style>
</head>
<body><div class="code">&lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">declare-step</span> <span class="code-xml-attribute-local-name">type</span>=<span class="code-xml-attribute-value">"css:shift-id"</span> <span class="code-xml-attribute-local-name">exclude-inline-prefixes</span>=<span class="code-xml-attribute-value">"#all"</span> <span class="code-xml-attribute-local-name">version</span>=<span class="code-xml-attribute-value">"1.0"</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
        Move css:id attributes to boxes.
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"source"</span> <span class="code-xml-attribute-local-name">sequence</span>=<span class="code-xml-attribute-value">"true"</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
            Boxes must be represented by css:box elements. target-counter() values must be
            represented by css:counter elements. If a document in the input sequence represents a
            named flow this must be indicated with a css:flow attribute on the document element.
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">input</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">output</span> <span class="code-xml-attribute-local-name">port</span>=<span class="code-xml-attribute-value">"result"</span> <span class="code-xml-attribute-local-name">sequence</span>=<span class="code-xml-attribute-value">"true"</span>&gt;
        &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
            For each non css:box element in the input with a css:id attribute, that attribute is
            moved to the first following css:box element. If this css:box element already has a
            css:id attribute in the input, the attribute is not overwritten. Instead, any
            target-counter() values and any elements in named flows that reference the non css:box
            element are altered to reference the following css:box element.
        &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">documentation</span>&gt;
    &lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">output</span>&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">wrap-sequence</span> <span class="code-xml-attribute-local-name">wrapper</span>=<span class="code-xml-attribute-value">"_"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">label-elements</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"css:box"</span> <span class="code-xml-attribute-local-name">attribute</span>=<span class="code-xml-attribute-value">"css:id"</span> <span class="code-xml-attribute-local-name">replace</span>=<span class="code-xml-attribute-value">"false"</span> <span class="code-xml-attribute-local-name">label</span>=<span class="code-xml-attribute-value">"string(                                ((preceding::*|ancestor::*)[not(self::css:box)][@css:id]                                                           [not(ancestor-or-self::*/@css:flow)]                                 except (preceding::css:box|ancestor::css:box)                                        [last()]/(preceding::*|ancestor::*)                                )[last()]/@css:id)"</span>/&gt;
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">delete</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"@css:id[.='']"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">label-elements</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"css:counter[@name][@target]"</span> <span class="code-xml-attribute-local-name">attribute</span>=<span class="code-xml-attribute-value">"target"</span> <span class="code-xml-attribute-local-name">label</span>=<span class="code-xml-attribute-value">"for $target in @target return                              //*[@css:id=$target]/(self::css:box|following::css:box|descendant::css:box)                              [not(ancestor-or-self::*/@css:flow)]                              [1]/@css:id"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">label-elements</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"*[@css:anchor]"</span> <span class="code-xml-attribute-local-name">attribute</span>=<span class="code-xml-attribute-value">"css:anchor"</span> <span class="code-xml-attribute-local-name">label</span>=<span class="code-xml-attribute-value">"for $anchor in @css:anchor return                              //*[@css:id=$anchor]/(self::css:box|following::css:box|descendant::css:box)                              [not(ancestor-or-self::*/@css:flow)]                              [1]/@css:id"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">delete</span> <span class="code-xml-attribute-local-name">match</span>=<span class="code-xml-attribute-value">"*[not(self::css:box)]/@css:id"</span>/&gt;
    
    &lt;<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">filter</span> <span class="code-xml-attribute-local-name">select</span>=<span class="code-xml-attribute-value">"/_/*"</span>/&gt;
    
&lt;/<span class="code-xml-element-prefix">p:</span><span class="code-xml-element-local-name">declare-step</span>&gt;</div></body>
</html>
